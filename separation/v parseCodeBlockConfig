parseCodeBlockConfig(source) {
  const config = {};
  const lines = source.split('\n').filter(line => line.trim());
  
  for (const line of lines) {
    const [key, value] = line.split(':').map(s => s.trim());
    if (key && value) {
      config[key] = value;
    }
  }
  
  // Use authenticated user if no username provided and no default username
  if (!config.username) {
    if (this.settings.defaultUsername) {
      config.username = this.settings.defaultUsername;
    } else if (this.settings.accessToken) {
      // We'll handle this in the processAniListCodeBlock method
      config.useAuthenticatedUser = true;
    } else {
      throw new Error('Username is required. Please set a default username in plugin settings, authenticate, or specify one in the code block.');
    }
  }
  
  config.listType = config.listType || 'CURRENT';
  config.layout = config.layout || this.settings.defaultLayout;
  config.mediaType = config.mediaType || 'ANIME';
  
  return config;
}